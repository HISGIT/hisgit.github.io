{% assign posts_language_version = site.posts | where_exp:'item', "page.ref != nil and item.ref == page.ref" | map: "language" %}
{% assign path = page.url | split: '/' | slice: 2, segments.size | join: '/' %}
{% if posts_language_version.size > 0 %}
<div class="language-selector">
  <ul>
    {% if posts_language_version contains "en" %}
    <li><a href="/en/{{ path }}" lang="en">English</a></li>
    {% endif %}
    {% if posts_language_version contains "zh" %}
    <li><a href="/zh/{{ path }}" lang="zh">中文</a></li>
    {% endif %}
    {% if posts_language_version contains "ja" %}
    <li><a href="/ja/{{ path }}" lang="ja">日本語</a></li>
    {% endif %}
  </ul>
</div>
{% endif %}
<nav id="primary-nav" class="site-nav" itemscope itemtype="http://schema.org/SiteNavigationElement"
  aria-label="Main navigation">
  <ul id="menu-main-navigation" class="menu">
    <!-- Home link -->
    <li class="menu-item">
      <a href="{{ '/' | relative_url }}" itemprop="url">
        <span itemprop="name">{{ site.data.theme.t.home | default: 'Home' }}</span>
      </a>
    </li>

    <!-- site.pages links -->
    {% assign default_paths = site.pages | map: "path" %}
    {% assign page_paths = site.data.theme.navigation_pages | default: default_paths %}

    {% for path in page_paths %}
    {% assign my_page = site.pages | where: "path", path | first %}
    {% if my_page.title %}
    <li class="menu-item">
      <a href="{{ my_page.url | relative_url }}" itemprop="url">
        <span itemprop="name">{{ my_page.title | escape }}</span>
      </a>
    </li>
    {% endif %}
    {% endfor %}
  </ul>
</nav>